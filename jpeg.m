function jpeg()
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%JPEG IMPLEMENTATION %%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
ratio=[1,3,5,10,20,30,50,70];

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%�Ҷ�ͼ������%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
figure;
for k=1:8
%I = imread('8.tif');
%I = imread('9.tif');
I = imread('cameraman.tif');
%I = im2double(I);% can be changed
% T = dctmtx(8); %can used fft here.
W = [16   11   10   16   24   40   51   61 ;
 12   12   14   19   26   58   60   55 ;
 14   13   16   24   40   57   69   56 ;
 14   17   22   29   51   87   80   62 ;
 18   22   37   56   68   109   103   77;
 24   35   55   64   81   104   113   92 ;
 49   64   78   87   103   121   120   101 ;
 72   92   95   98   112   100   103   99];%��������
% dct = @(block_struct) T * block_struct.data * T' ./ W;
dct1 = @(block_struct) dct2(block_struct.data)./ W ;%dct2��������
B = blockproc(I,[8 8],dct1);     %�����Ƿֿ���������,dct1�ǲ����ľ���
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
B(abs(B)<ratio(k))=0;%ȥ����Ƶ���� %�̳�http://blog.sina.com.cn/s/blog_52fce1420100erqb.html
[indi,indj]=find(B~=0);
n=size(indi,1);
A=size(B);
Compression_ratio=A(1)*A(2)/n;
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
B2 = blockproc(B,[8 8],@(block_struct) block_struct.data.* W);%������
invdct2 = @(block_struct)  idct2(block_struct.data) ;
I2 = blockproc(B2,[8 8],invdct2);
I2 =I2./256;%��ʱI2�����õ�������ȴ��ת������double��ʽ������Ҫת����imshow��Ӧ�ķ�Χ
I = im2double(I);
subplot(3,3,1);
imshow(I);
title('ԭͼ');
subplot(3,3,k+1);
SNR = calc_snr( I,I2 );
SNR=round(SNR*100)/100;
imshow(I2);
title( sprintf('ѹ����%d:1�������� ��db�� %d',Compression_ratio,20*log10(SNR)) );
end


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%��ɫͼ������%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
figure;
for k=1:8
I = imread('У������.jpg');
% Si=size(I);
% Slow=min(Si(1),Si(2));
cutl=256;

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
I=I(1:cutl,1:cutl,:);
R=I(:,:,1);
G=I(:,:,2);
H=I(:,:,3);
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%��֪Ϊ�κ���RBG��YUV�ռ��ı任�����⣬�任��������ԭͼ
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Y = 0.299 * R + 0.587 * G + 0.114 * H;
% U = -0.14713 * R - 0.28886 * G + 0.436 * H;
% V = 0.615 * R - 0.51499 * G - 0.10001 * H;
%
% YY = quantize( R,ratio(k) );
% UU = quantize( G,ratio(k) );
% VV = quantize( B,ratio(k) );

% Y=YY(:,:,1);
% U=UU(:,:,1);
% V=VV(:,:,1);

% R = Y + 1.13983 * V;
% G = Y - 0.39465 * U - 0.58060 * V;
% B = Y + 2.03211 * U;

% I(:,:,1)=R;
% I(:,:,2)=G;
% I(:,:,3)=B;

% I2=I;
% % Y=YY(:,:,2);
% % U=UU(:,:,2);
% % V=VV(:,:,2);
%
% % R = Y + 1.13983 * V;
% % G = Y - 0.39465 * U - 0.58060 * V;
% % B = Y + 2.03211 * U;
% %
% % I2(:,:,1)=R;
% % I2(:,:,2)=G;
% % I2(:,:,3)=B;
% % I(:,:,1)=YY(:,:,1);
% % I(:,:,2)=UU(:,:,1);
% % I(:,:,3)=VV(:,:,1);
% % I2(:,:,1)=YY(:,:,2);
% % I2(:,:,2)=UU(:,:,2);
% % I2(:,:,3)=VV(:,:,2);
%
% % Compression_ratio=1/((1/YY(1,1,3)+1/UU(1,1,3)+1/VV(1,1,3))/3);


% % %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% % %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% %I = im2double(I);% can be changed
% % T = dctmtx(8); %can used fft here.
% W = [16   11   10   16   24   40   51   61 ;
%  12   12   14   19   26   58   60   55 ;
%  14   13   16   24   40   57   69   56 ;
%  14   17   22   29   51   87   80   62 ;
%  18   22   37   56   68   109   103   77;
%  24   35   55   64   81   104   113   92 ;
%  49   64   78   87   103   121   120   101 ;
%  72   92   95   98   112   100   103   99];%��������
% % dct = @(block_struct) T * block_struct.data * T' ./ W;
% dct1 = @(block_struct) dct2(block_struct.data)./ W ;%dct2��������
% B = blockproc(I,[8 8],dct1);     %�����Ƿֿ���������,dct1�ǲ����ľ���
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% B(abs(B)<ratio(k))=0;%ȥ����Ƶ���� %�̳�http://blog.sina.com.cn/s/blog_52fce1420100erqb.html
% [indi,indj]=find(B~=0);
% n=size(indi,1);
% A=size(B);
% Compression_ratio=A(1)*A(2)/n;
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% B2 = blockproc(B,[8 8],@(block_struct) block_struct.data.* W);%������
% invdct2 = @(block_struct)  idct2(block_struct.data) ;
% I2 = blockproc(B2,[8 8],invdct2);
% I2 =I2./256;%��ʱI2�����õ�������ȴ��ת������double��ʽ������Ҫת����imshow��Ӧ�ķ�Χ
% I = im2double(I);
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%I = im2double(I);% can be changed
% T = dctmtx(8); %can used fft here.
W = [16   11   10   16   24   40   51   61 ;
 12   12   14   19   26   58   60   55 ;
 14   13   16   24   40   57   69   56 ;
 14   17   22   29   51   87   80   62 ;
 18   22   37   56   68   109   103   77;
 24   35   55   64   81   104   113   92 ;
 49   64   78   87   103   121   120   101 ;
 72   92   95   98   112   100   103   99];%��������
% dct = @(block_struct) T * block_struct.data * T' ./ W;
dct1 = @(block_struct) dct2(block_struct.data)./ W ;%dct2��������
B = blockproc(R,[8 8],dct1);     %�����Ƿֿ���������,dct1�ǲ����ľ���
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
B(abs(B)<ratio(k))=0;%ȥ����Ƶ���� %�̳�http://blog.sina.com.cn/s/blog_52fce1420100erqb.html
[indi,indj]=find(B~=0);
n=size(indi,1);
A=size(B);
Compression_ratio1=A(1)*A(2)/n;
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
B2 = blockproc(B,[8 8],@(block_struct) block_struct.data.* W);%������
invdct2 = @(block_struct)  idct2(block_struct.data) ;
I2 = blockproc(B2,[8 8],invdct2);
I2 =I2./256;%��ʱI2�����õ�������ȴ��ת������double��ʽ������Ҫת����imshow��Ӧ�ķ�Χ
I = im2double(I);
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%I = im2double(I);% can be changed
% T = dctmtx(8); %can used fft here.
W = [16   11   10   16   24   40   51   61 ;
 12   12   14   19   26   58   60   55 ;
 14   13   16   24   40   57   69   56 ;
 14   17   22   29   51   87   80   62 ;
 18   22   37   56   68   109   103   77;
 24   35   55   64   81   104   113   92 ;
 49   64   78   87   103   121   120   101 ;
 72   92   95   98   112   100   103   99];%��������
% dct = @(block_struct) T * block_struct.data * T' ./ W;
dct1 = @(block_struct) dct2(block_struct.data)./ W ;%dct2��������
B = blockproc(G,[8 8],dct1);     %�����Ƿֿ���������,dct1�ǲ����ľ���
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
B(abs(B)<ratio(k))=0;%ȥ����Ƶ���� %�̳�http://blog.sina.com.cn/s/blog_52fce1420100erqb.html
[indi,indj]=find(B~=0);
n=size(indi,1);
A=size(B);
Compression_ratio2=A(1)*A(2)/n;
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
B2 = blockproc(B,[8 8],@(block_struct) block_struct.data.* W);%������
invdct2 = @(block_struct)  idct2(block_struct.data) ;
I3 = blockproc(B2,[8 8],invdct2);
I3 =I3./256;%��ʱI2�����õ�������ȴ��ת������double��ʽ������Ҫת����imshow��Ӧ�ķ�Χ
I = im2double(I);
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%I = im2double(I);% can be changed
% T = dctmtx(8); %can used fft here.
W = [16   11   10   16   24   40   51   61 ;
 12   12   14   19   26   58   60   55 ;
 14   13   16   24   40   57   69   56 ;
 14   17   22   29   51   87   80   62 ;
 18   22   37   56   68   109   103   77;
 24   35   55   64   81   104   113   92 ;
 49   64   78   87   103   121   120   101 ;
 72   92   95   98   112   100   103   99];%��������
% dct = @(block_struct) T * block_struct.data * T' ./ W;
dct1 = @(block_struct) dct2(block_struct.data)./ W ;%dct2��������
B = blockproc(H,[8 8],dct1);     %�����Ƿֿ���������,dct1�ǲ����ľ���
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
B(abs(B)<ratio(k))=0;%ȥ����Ƶ���� %�̳�http://blog.sina.com.cn/s/blog_52fce1420100erqb.html
[indi,indj]=find(B~=0);
n=size(indi,1);
A=size(B);
Compression_ratio3=A(1)*A(2)/n;
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
B2 = blockproc(B,[8 8],@(block_struct) block_struct.data.* W);%������
invdct2 = @(block_struct)  idct2(block_struct.data) ;
I4 = blockproc(B2,[8 8],invdct2);
I4 =I4./256;%��ʱI2�����õ�������ȴ��ת������double��ʽ������Ҫת����imshow��Ӧ�ķ�Χ
I = im2double(I);
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
Compression_ratio(k)=1/((1/Compression_ratio1+1/Compression_ratio2+1/Compression_ratio3)/3);
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
subplot(3,3,1);
imshow(I);
title('ԭͼ');
II=zeros(256,256,3);
% R = I2 + 1.13983 * I4;
% G = I2 - 0.39465 * I3 - 0.58060 * I4;
% H = I2 + 2.03211 * I3;

II(:,:,1)=I2;
II(:,:,2)=I3;
II(:,:,3)=I4;
SNR(k) = calc_snr( I,II );
SNR(k)=round(SNR(k)*100)/100;
subplot(3,3,k+1);
imshow(II);
%imshow(II-I);
title( sprintf('ѹ����%d:1�������ȣ�db�� %d',Compression_ratio(k),20*log10(SNR(k))) );
end
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% ������ͼ
figure;
plot( Compression_ratio,20*log10(SNR) );
xlabel( 'ѹ����' );
ylabel( '������ [db] ( 20*log10(.) )' );
title( '��ͬѹ�����µ�������ʾ��ͼ' );
grid on;

end


function II = quantize( I,limit )
%%��������֪Ϊ����Ч
%I = im2double(I);% can be changed
% T = dctmtx(8); %can used fft here.
W = [16   11   10   16   24   40   51   61 ;
 12   12   14   19   26   58   60   55 ;
 14   13   16   24   40   57   69   56 ;
 14   17   22   29   51   87   80   62 ;
 18   22   37   56   68   109   103   77;
 24   35   55   64   81   104   113   92 ;
 49   64   78   87   103   121   120   101 ;
 72   92   95   98   112   100   103   99];%��������
% dct = @(block_struct) T * block_struct.data * T' ./ W;
dct1 = @(block_struct) dct2(block_struct.data)./ W ;%dct2��������
B = blockproc(I,[8 8],dct1);     %�����Ƿֿ���������,dct1�ǲ����ľ���
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
B(abs(B)<limit)=0;%ȥ����Ƶ���� %�̳�http://blog.sina.com.cn/s/blog_52fce1420100erqb.html
[indi,indj]=find(B~=0);
n=size(indi,1);
A=size(B);
Compression_ratio=A(1)*A(2)/n;
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
B2 = blockproc(B,[8 8],@(block_struct) block_struct.data.* W);%������
invdct2 = @(block_struct)  idct2(block_struct.data) ;
I2 = blockproc(B2,[8 8],invdct2);
% I2=I2+128;
I2 =I2./256;%��ʱI2�����õ�������ȴ��ת������double��ʽ������Ҫת����imshow��Ӧ�ķ�Χ
I = im2double(I);
si=size(I);
II=zeros(si(1),si(2),3);
II(:,:,1)=I;
II(:,:,2)=I2;
II(1,1,3)=Compression_ratio;
end


function SNR = calc_snr( original_image,noisy_image )


original_image_energy = sum( original_image(:).^2 );
noise_energy = sum( (original_image(:)-noisy_image(:)).^2 );
SNR = original_image_energy/noise_energy;

end
